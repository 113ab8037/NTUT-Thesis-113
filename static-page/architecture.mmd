%%{init: {
  "flowchart": {
    "ranksep": 80,
    "nodesep": 60
  }
}}%%
graph TD
    subgraph ä½¿ç”¨è€…ä»‹é¢  GUI 
        direction TB
        User[ğŸ‘¤ ä½¿ç”¨è€…] -- ç™¼èµ·ä»»å‹™ --> UI[<b>Streamlit UI</b><br> ä»»å‹™ç™¼èµ·é» ]
        
    end
    subgraph Framework
        subgraph ç¸½æŒ‡æ®ä¸­å¿ƒ  MCP Host - AutoGen
            direction TB
            UI -- æä¾›SUTè¦æ ¼  --> Wrapper[<b>FastAPI Server</b><br> æ¥æ”¶ UI è«‹æ±‚ ]

            subgraph AutoGen ä»£ç†åœ˜éšŠ
                direction LR
                Planner[<b>Planner Agent</b><br> ç¸½è¦åŠƒå¸« ]
                Coder[<b>Test_Coder_Agent</b><br> ç”Ÿæˆ Script ]
                Executor[<b>Executor_Agent</b><br> åŸ·è¡Œæ¸¬è©¦ ]
                Analyzer[<b>Analyzer_Agent</b><br> åˆ†æ / re-loop ]
                Reporter[<b>Reporter_Agent</b><br> ç”Ÿæˆå ±å‘Š/æ–‡ä»¶ ]
            end

            A2A_Client[<b>A2A Client Agent</b><br> å°å¤–è¯çµ¡çª—å£ ]
            Client_MCP[<b>MCP Client</b><br> å…§éƒ¨å·¥å…·å®¢æˆ¶ç«¯ ]

            Wrapper -- 1.  å–šé†’  --> Planner
            Planner -- 2.  æŒ‡æ®  --> Client_MCP
            Planner --  6. åˆ†æ´¾  --> Coder --  7. æäº¤  --> Executor --  8. å›å‚³  --> Analyzer
            Analyzer --  9. re-loop  --> Coder
            Analyzer --  10. æˆåŠŸ  --> Planner
            Planner -- 11.  å½™ç¸½çµæœ  --> Reporter
            Reporter -- 12.  ç”Ÿæˆ[æ–‡ä»¶]  --> Planner
            Planner -- 13.  æŒ‡æ®å§”æ´¾  --> A2A_Client
            
            
        end
        
        subgraph å·¥å…·ä¼ºæœå™¨ MCP Server 
            direction TB
            
            Server_MCP[<b> MCP Server - LangChain </b><br> ç­–ç•¥å¸« ]
            subgraph C1 [LangChain æ ¸å¿ƒå·¥å…·]
                Tools[<b>LangChain Tools</b><br> RAG / æ¡ˆä¾‹ / Inputç”Ÿæˆ]
                
            end
            Tools -- è®€å–è¦æ ¼æ–‡ä»¶ ï¼ OpenAPI.json, SA Docs  --> VDB
            Server_MCP -- 4. åŸ·è¡Œ --> Tools
            VDB[<b>VDB ChromaDB</b><br> å„²å­˜ SUT è¦æ ¼/SA æ–‡ä»¶]
            
        end

        subgraph å¾…æ¸¬ç³»çµ± - System Under Test
            SUT[<b>RESTful ç¶²ç«™ www </b><br> è¢«å‹•çš„æ¸¬è©¦ç›®æ¨™ <br>]
            
        end

        subgraph åŸºç¤è¨­æ–½  Infrastructure 
            OLLAMA[<b>Ollama LLM</b><br> Llama 3 / Gemma ]
        end

        subgraph Peer Agent  å¤–éƒ¨ä»£ç† 
            direction TB
            GitOps_Host[<b>GitOps Agent  Host 2 </b><br> ç¨ç«‹çš„ CI/CD ä»£ç† ]
            Git_Repo[<b>SUT çš„ Git Repository</b><br> e.g., GitHub / GitLab ]
            GitOps_Host -- 15.  åŸ·è¡Œ Git æ“ä½œ  --> Git_Repo
        end
    end
    %% --- è³‡è¨Šæµ  Information Flow  --- %%
    
    %% æµç¨‹ 1: AutoGen å‘¼å« LangChain  MCP å”å®š - å‚ç›´ 
    Client_MCP -- 3.  MCP Request  --> Server_MCP
   
    Server_MCP -- 5.  MCP Response  --> Client_MCP

    %% æµç¨‹ 2: AutoGen å‘¼å« SUT  HTTP å”å®š 
    Executor --  HTTP Test Request  --> SUT

    SUT --  HTTP Test Response  --> Executor

    %% ---------------------------------------------- %%
    %% æµç¨‹ 3: AutoGen å‘¼å« Peer Agent  A2A å”å®š - æ°´å¹³ 
    %% é€™æ˜¯æ‚¨çš„æ–°éœ€æ±‚ï¼
    A2A_Client -- 14.  <b>A2A Request</b><br>  è«‹å¹«æˆ‘é–‹ PR ä¸¦æä¾›[æ–‡ä»¶]   --> GitOps_Host
    GitOps_Host --  A2A Response<br>  PR é€£çµ: ...   --> A2A_Client
    %% ---------------------------------------------- %%

    %% æµç¨‹ 4: LLM å‘¼å«  æœ¬åœ° API 
    Planner --  å‘¼å«æ€è€ƒ  --> OLLAMA
    Reporter --  å‘¼å«ç”Ÿæˆå ±å‘Š  --> OLLAMA
    Tools --  å‘¼å«RAG/ç”ŸæˆInput  --> OLLAMA

    OLLAMA  --> Wrapper -- 16.  é¡¯ç¤º[æœ€çµ‚å ±å‘Š+PR]  --> UI